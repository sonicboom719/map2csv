# PinMap-Overlay ツール

地図画像（PDF/画像ファイル）をGoogle Maps/OpenStreetMap上に重ね合わせ、ピンを配置してポスター掲示場情報を管理するWebアプリケーションです。

## 機能

### 1. 地図画像のアップロード
- ドラッグ&ドロップ、クリック選択、クリップボード貼り付け（Ctrl+V）に対応
- PDF、PNG、JPEG等の画像形式をサポート
- PDFは自動的に画像に変換

### 2. 地図エリアの指定
- 住所を入力して地図を該当エリアに移動
- Nominatim APIによる自動ジオコーディング

### 3. 画像の位置合わせ
- **2点対応方式**による高精度な位置合わせ
- STEP1: 青ウィンドウで画像上の2点を選択（ドラッグで調整可能）
- STEP2: 地図上で対応する2点を選択（ドラッグで調整可能）
- STEP3: 位置合わせを実行
- **高度な機能**:
  - 自動回転補正（画像と地図の向きの違いを自動調整）
  - アスペクト比保持
  - 画像表示コントロール（透明度調整、表示/非表示切り替え）
  - 位置再調整機能
  - 元画像表示モーダル

### 4. ピンの配置と管理
- 地図上をクリックしてピンを配置
- 各ピンに以下の情報を登録：
  - **ピン番号（表示用）**: マップ上のピンに数字を表示
  - **掲示場番号**: CSV出力用の識別番号
  - **場所名称**: 掲示場や場所の名前
  - **メモ**: 改行不可のテキスト（任意）
- ピンはドラッグで位置調整可能
- 右サイドバーでピン一覧を管理
- **インタラクティブ機能**:
  - マップ上のピンにマウスオーバー → ピンリストがハイライト
  - ピンリストにマウスオーバー → マップ上のピンが拡大・色変更

### 5. データエクスポート
- CSV形式でピン情報をダウンロード
- ファイル名: `{市区町村名}_normalized_yyyymmddhhmmss.csv`
- 出力形式: `prefecture,city,number,address,name,lat,long,note`
- UTF-8（BOMなし）、引用符なし

## 使い方

1. **画像をアップロード**
   - 地図画像をドラッグ&ドロップまたは選択

2. **地図のエリアを入力**
   - おおよその住所を入力して「地図を移動」をクリック

3. **画像の位置合わせ**
   - 青ウィンドウで画像上の2点（道路の交差点など）を選択
   - 地図上で対応する2点を選択
   - 「位置合わせを実行」をクリック

4. **ピンを配置**
   - 地図上をクリックしてピンを配置
   - モーダルで情報を入力：
     - ピン番号（表示用）: 1-999の数字（任意）
     - 掲示場番号: CSV出力用識別子
     - 場所名称: 掲示場名など
     - メモ: 補足情報（改行不可）

5. **CSVダウンロード**
   - 都道府県・市区町村を入力
   - 「正規化CSVダウンロード」をクリック
   - ピン番号は表示のみでCSVには含まれません

## 技術仕様

### 使用ライブラリ
- Leaflet.js 1.9.4 - 地図表示
- OpenStreetMap - 地図タイル
- PDF.js 3.11.174 - PDF処理
- PapaParser 5.4.1 - CSV生成
- Nominatim API - ジオコーディング

### ブラウザ要件
- モダンブラウザ（Chrome, Firefox, Safari, Edge）
- JavaScript有効

### ファイル構成
```
pinmap_overlay/
├── index.html          # メインHTML
├── css/
│   └── style.css      # スタイルシート
├── js/
│   ├── main.js        # メインアプリケーション
│   ├── map.js         # 地図管理
│   ├── uploader.js    # 画像アップロード
│   ├── overlay-simple-clean.js  # オーバーレイ管理
│   ├── simple-drag-resize.js    # ドラッグ&リサイズウィンドウ
│   ├── pins.js        # ピン管理
│   └── export.js      # CSVエクスポート
└── APP.md             # アプリケーション仕様書
```

## 注意事項

- インターネット接続が必要（地図タイル、ジオコーディングAPI）
- 大きな画像ファイルの処理には時間がかかる場合があります
- ブラウザのローカルストレージは使用していないため、リロード時にデータは失われます

## ライセンス

本プロジェクトのライセンスについては、個別にお問い合わせください。