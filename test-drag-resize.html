<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ‰ãƒ©ãƒƒã‚°&ãƒªã‚µã‚¤ã‚ºãƒ†ã‚¹ãƒˆ</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background: #f0f0f0;
        }
        
        #testButton {
            padding: 15px 30px;
            font-size: 16px;
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin-bottom: 20px;
        }
        
        #testButton:hover {
            background: #c0392b;
        }
        
        .draggable-container {
            position: fixed;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            overflow: visible;
            z-index: 1000;
        }
        
        .title-bar {
            background: #e74c3c;
            color: white;
            padding: 15px 20px;
            font-weight: bold;
            cursor: move;
            user-select: none;
            border-radius: 12px 12px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .title-bar:hover {
            background: #c0392b;
        }
        
        .close-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            font-size: 18px;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
        }
        
        .content-area {
            position: relative;
            padding: 20px;
            background: white;
            border-radius: 0 0 12px 12px;
        }
        
        .test-canvas {
            border: 2px solid #3498db;
            border-radius: 8px;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="400" height="300"><rect width="400" height="300" fill="%23f8f9fa"/><text x="200" y="150" text-anchor="middle" font-family="Arial" font-size="24" fill="%23666">ãƒ†ã‚¹ãƒˆç”»åƒ</text><circle cx="50" cy="50" r="20" fill="%23e74c3c"/><circle cx="350" cy="50" r="20" fill="%233498db"/><circle cx="350" cy="250" r="20" fill="%2328a745"/><circle cx="50" cy="250" r="20" fill="%23f39c12"/></svg>');
            background-size: contain;
            background-repeat: no-repeat;
        }
        
        .resize-handle {
            position: absolute;
            width: 24px;
            height: 24px;
            background: #3498db;
            border: 4px solid white;
            border-radius: 50%;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            z-index: 10;
            opacity: 1;
            transition: transform 0.2s ease;
        }
        
        .resize-handle:hover {
            transform: scale(1.2);
            background: #2980b9;
        }
        
        .resize-nw {
            top: -12px;
            left: -12px;
            cursor: nw-resize;
        }
        
        .resize-ne {
            top: -12px;
            right: -12px;
            cursor: ne-resize;
        }
        
        .resize-se {
            bottom: -12px;
            right: -12px;
            cursor: se-resize;
        }
        
        .resize-sw {
            bottom: -12px;
            left: -12px;
            cursor: sw-resize;
        }
        
        .instructions {
            background: #e8f5e8;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #27ae60;
        }
        
        .instructions h3 {
            margin: 0 0 10px 0;
            color: #27ae60;
        }
    </style>
</head>
<body>
    <div class="instructions">
        <h3>ğŸ§ª ãƒ‰ãƒ©ãƒƒã‚°&ãƒªã‚µã‚¤ã‚ºæ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ</h3>
        <p><strong>æ“ä½œæ–¹æ³•:</strong></p>
        <ul>
            <li>ğŸ”´ <strong>èµ¤ã„ã‚¿ã‚¤ãƒˆãƒ«ãƒãƒ¼</strong>ã‚’ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦ç§»å‹•</li>
            <li>ğŸ”µ <strong>4éš…ã®é’ã„ä¸¸</strong>ã‚’ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦ã‚µã‚¤ã‚ºå¤‰æ›´</li>
            <li>âœ• <strong>é–‰ã˜ã‚‹ãƒœã‚¿ãƒ³</strong>ã§ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’é–‰ã˜ã‚‹</li>
        </ul>
    </div>
    
    <button id="testButton">ğŸ“· ãƒ†ã‚¹ãƒˆã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’è¡¨ç¤º</button>
    
    <script>
        class DraggableResizable {
            constructor() {
                this.isDragging = false;
                this.isResizing = false;
                this.currentHandle = null;
                this.startX = 0;
                this.startY = 0;
                this.startLeft = 0;
                this.startTop = 0;
                this.startWidth = 400;
                this.startHeight = 300;
                this.container = null;
                this.canvas = null;
            }
            
            create() {
                // ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒŠ
                this.container = document.createElement('div');
                this.container.className = 'draggable-container';
                this.container.style.left = '50%';
                this.container.style.top = '50%';
                this.container.style.transform = 'translate(-50%, -50%)';
                
                // ã‚¿ã‚¤ãƒˆãƒ«ãƒãƒ¼
                const titleBar = document.createElement('div');
                titleBar.className = 'title-bar';
                titleBar.innerHTML = `
                    <span>ğŸ“· ã“ã®èµ¤ã„ãƒãƒ¼ã‚’ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦ç§»å‹•ã—ã¦ãã ã•ã„</span>
                    <button class="close-btn">Ã—</button>
                `;
                
                // ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¨ãƒªã‚¢
                const contentArea = document.createElement('div');
                contentArea.className = 'content-area';
                
                // ãƒ†ã‚¹ãƒˆç”¨ã‚­ãƒ£ãƒ³ãƒã‚¹
                this.canvas = document.createElement('div');
                this.canvas.className = 'test-canvas';
                this.canvas.style.width = this.startWidth + 'px';
                this.canvas.style.height = this.startHeight + 'px';
                
                // DOMæ§‹ç¯‰
                contentArea.appendChild(this.canvas);
                this.container.appendChild(titleBar);
                this.container.appendChild(contentArea);
                document.body.appendChild(this.container);
                
                // ãƒªã‚µã‚¤ã‚ºãƒãƒ³ãƒ‰ãƒ«ã‚’è¿½åŠ 
                this.addResizeHandles(contentArea);
                
                // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š
                this.setupEvents(titleBar);
                
                return this.container;
            }
            
            addResizeHandles(contentArea) {
                const handles = [
                    { class: 'resize-nw', cursor: 'nw-resize' },
                    { class: 'resize-ne', cursor: 'ne-resize' },
                    { class: 'resize-se', cursor: 'se-resize' },
                    { class: 'resize-sw', cursor: 'sw-resize' }
                ];
                
                handles.forEach(handleInfo => {
                    const handle = document.createElement('div');
                    handle.className = `resize-handle ${handleInfo.class}`;
                    
                    // ãƒªã‚µã‚¤ã‚ºã‚¤ãƒ™ãƒ³ãƒˆ
                    handle.addEventListener('mousedown', (e) => {
                        this.startResize(e, handleInfo.class);
                    });
                    
                    contentArea.appendChild(handle);
                });
            }
            
            setupEvents(titleBar) {
                // ãƒ‰ãƒ©ãƒƒã‚°ã‚¤ãƒ™ãƒ³ãƒˆ
                titleBar.addEventListener('mousedown', (e) => {
                    if (e.target.className === 'close-btn') {
                        this.container.remove();
                        return;
                    }
                    this.startDrag(e);
                });
                
                // ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒã‚¦ã‚¹ã‚¤ãƒ™ãƒ³ãƒˆ
                document.addEventListener('mousemove', (e) => {
                    if (this.isDragging) {
                        this.doDrag(e);
                    } else if (this.isResizing) {
                        this.doResize(e);
                    }
                });
                
                document.addEventListener('mouseup', () => {
                    this.stopDrag();
                    this.stopResize();
                });
            }
            
            startDrag(e) {
                this.isDragging = true;
                this.startX = e.clientX;
                this.startY = e.clientY;
                
                const rect = this.container.getBoundingClientRect();
                this.startLeft = rect.left;
                this.startTop = rect.top;
                
                document.body.style.userSelect = 'none';
                e.preventDefault();
            }
            
            doDrag(e) {
                const deltaX = e.clientX - this.startX;
                const deltaY = e.clientY - this.startY;
                
                this.container.style.left = (this.startLeft + deltaX) + 'px';
                this.container.style.top = (this.startTop + deltaY) + 'px';
                this.container.style.transform = 'none';
            }
            
            stopDrag() {
                this.isDragging = false;
                document.body.style.userSelect = '';
            }
            
            startResize(e, handleClass) {
                this.isResizing = true;
                this.currentHandle = handleClass;
                this.startX = e.clientX;
                this.startY = e.clientY;
                this.startWidth = this.canvas.offsetWidth;
                this.startHeight = this.canvas.offsetHeight;
                
                document.body.style.userSelect = 'none';
                e.preventDefault();
                e.stopPropagation();
            }
            
            doResize(e) {
                const deltaX = e.clientX - this.startX;
                const deltaY = e.clientY - this.startY;
                
                let newWidth = this.startWidth;
                let newHeight = this.startHeight;
                
                switch(this.currentHandle) {
                    case 'resize-se':
                        newWidth = this.startWidth + deltaX;
                        newHeight = this.startHeight + deltaY;
                        break;
                    case 'resize-sw':
                        newWidth = this.startWidth - deltaX;
                        newHeight = this.startHeight + deltaY;
                        break;
                    case 'resize-ne':
                        newWidth = this.startWidth + deltaX;
                        newHeight = this.startHeight - deltaY;
                        break;
                    case 'resize-nw':
                        newWidth = this.startWidth - deltaX;
                        newHeight = this.startHeight - deltaY;
                        break;
                }
                
                // ã‚µã‚¤ã‚ºåˆ¶é™
                newWidth = Math.max(200, Math.min(800, newWidth));
                newHeight = Math.max(150, Math.min(600, newHeight));
                
                this.canvas.style.width = newWidth + 'px';
                this.canvas.style.height = newHeight + 'px';
            }
            
            stopResize() {
                this.isResizing = false;
                this.currentHandle = null;
                document.body.style.userSelect = '';
            }
        }
        
        // ãƒ†ã‚¹ãƒˆãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆ
        document.getElementById('testButton').addEventListener('click', () => {
            new DraggableResizable().create();
        });
    </script>
</body>
</html>